(()=>{class e{static isValid(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}}class t{constructor(e,t){this.agreement=document.getElementById(e),this.gameInstance=t,this.agreement.addEventListener("change",(()=>{this.gameInstance.validateForm()}))}get isChecked(){return this.agreement.checked}}class n{static mainUrl="http://localhost:4000";static async checkBonus(e){try{const t=`${n.mainUrl}/check-bonus`,s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(!s.ok)throw new Error("Запит не вдався");return await s.json()}catch(e){throw console.error("Помилка:",e),e}}static async getBonus(e,t){try{const s=`${n.mainUrl}/get-bonus`,i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,agreement:t})});if(!i.ok)throw new Error("Запит не вдався");return await i.json()}catch(e){throw console.error("Помилка:",e),e}}}class s{static showBonus(e){document.querySelector(".wheelContainer").style.display="none","No prize"===e?s.showNoBonus():s.showBonusAside(e)}static showBonusAside(e){document.querySelector(".victory").style.display="flex",document.querySelector(".victory__prizeVal").innerText=e}static showNoBonus(){document.querySelector(".noPrize").style.display="flex",setInterval(s.updateCountdown,1e3)}static updateCountdown(){const e=new Date,t=new Date(e);t.setHours(24,0,0,0);const n=t-e;if(n<=0)return void(document.getElementById("countdown").textContent="Опівніч вже настала!");const s=Math.floor(n/36e5),i=Math.floor(n%36e5/6e4),o=Math.floor(n%6e4/1e3);document.querySelectorAll(".btn__timer").forEach((e=>e.textContent=`${s}:${i}:${o}`))}}class i{constructor(e){this.wheel=document.querySelector(e),this.rotationDegree=0}spin(e){this.wheel.style.transition="transform 4s ease-in-out",this.wheel.style.transform=`translate(-50%, -50%) rotate(${e}deg)`}static defineBonusSectorDegree(e){const t=[{value:"10 free spins to deposit",sectorDegree:0},{value:"120% to deposit",sectorDegree:45},{value:"10 free spins to deposit",sectorDegree:90},{value:"115% to deposit",sectorDegree:135},{value:"15 free spins to deposit",sectorDegree:180},{value:"120% to deposit",sectorDegree:225},{value:"No prize",sectorDegree:270},{value:"100% to deposit",sectorDegree:315},{value:"10 free spins to deposit",sectorDegree:360}].find((t=>t.value===e));return t?-t.sectorDegree:0}}window.game=new class{constructor(){this.agreement=new t("agreement",this),this.wheel=new i(".wheel__sectors"),this.submitBtn=document.getElementById("enterEmail__btn"),this.emailInput=document.getElementById("playerEmail"),this.initEventListeners(),this.validateForm()}initEventListeners(){this.emailInput.addEventListener("input",(()=>this.validateForm())),this.agreement.agreement.addEventListener("change",(()=>this.validateForm())),document.getElementById("enterEmail__btn").addEventListener("click",(()=>this.checkValidEmailAndcheckBonusExistence())),document.querySelector(".wheel__btn").addEventListener("click",(()=>this.mainSpinWheel())),document.querySelector(".btn__spinWheel").addEventListener("click",(()=>this.mainSpinWheel())),document.querySelectorAll(".btn__spinAgain").forEach((e=>e.addEventListener("click",(e=>{e.target.closest("aside").style.display="none",document.getElementById("wheel").style.display="flex"})))),document.querySelectorAll(".containerCloseButton").forEach((e=>e.addEventListener("click",(e=>{e.target.closest("aside").style.display="none"})))),document.querySelector(".enterEmail__form").addEventListener("submit",(e=>{e.preventDefault(),this.checkValidEmailAndcheckBonusExistence()}))}validateForm(){const t=this.emailInput.value.trim(),n=e.isValid(t),s=this.agreement.isChecked;this.submitBtn.disabled=!(n&&s)}async checkValidEmailAndcheckBonusExistence(){const t=document.getElementById("playerEmail").value;if(!this.agreement.isChecked)return void alert("Please, confirm agreement");if(!t)return void alert("Please, enter your email");if(!e.isValid(t))return void alert("Please, enter a valid email");const s=await n.checkBonus(t);!s.userExist||!1===s.bonusExist&&s.spinsAmount<2?document.querySelector(".wheelContainer").style.display="flex":document.querySelector(".bonusReceived").style.display="flex"}async mainSpinWheel(){if(console.log("mainSpinWheel called"),this.isSpinning)return;this.isSpinning=!0;const t=document.getElementById("playerEmail").value,o=document.querySelector(".wheel__btn");if(e.isValid(t)){o.disabled=!0;try{const e=await n.getBonus(t,this.agreement.isChecked);if(!e)return;const r=360*5,a=i.defineBonusSectorDegree(e.bonus);null!==a&&(this.wheel.spin(r+a),setTimeout((()=>{s.showBonus(e.bonus),o.disabled=!1,this.isSpinning=!1}),5e3),setTimeout((()=>{this.resetWheel()}),5001))}catch(e){console.error("Error spinning wheel:",e),o.disabled=!1}}else alert("Please enter your email first to proceed.")}resetWheel(){this.wheel.wheel.style.transform="translate(-50%, -50%) rotate(0deg)"}}})();